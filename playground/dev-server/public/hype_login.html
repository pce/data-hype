<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Hype Declarative Login Demo</title>
  <!-- Tailwind and playground stylesheet (CSP-friendly external files) -->
  <link rel="stylesheet" href="/tailwind.css" />
  <link rel="stylesheet" href="/static/css/index.css" />
</head>
<body>
  <div class="max-w-3xl mx-auto space-y-6">
    <header>
      <h1 class="text-xl font-semibold mb-1">Hype Declarative Login — No inline JS</h1>
      <p class="muted">Attribute-driven login forms keep templates clean — the Hype runtime wires behavior when initialized.</p>
    </header>

    <section class="card" aria-labelledby="minimal-declarative">
      <h2 id="minimal-declarative" class="text-lg font-medium mb-2">1) Minimal declarative login (no inline JS)</h2>
      <p class="muted mb-4">
        The runtime binds forms by attribute. Use normal inputs named <code>username</code> and <code>password</code>.
      </p>

      <!--
        - class="hype-login-form" is recognized by optional auth binders
        - inputs named "username" / "password" are mapped by the default credentialMapper
        - [data-login-message] is used by clients to show status messages (configurable)
        - No inline onclick/onsubmit attributes are used
      -->
      <form class="hype-login-form" method="post" autocomplete="off" novalidate>
        <div class="field">
          <label for="u1">Username</label>
          <input id="u1" name="username" type="text" required />
        </div>

        <div class="field">
          <label for="p1">Password</label>
          <input id="p1" name="password" type="password" required />
        </div>

        <div class="flex items-center gap-3">
          <button type="submit" class="btn">Sign in</button>
          <div data-login-message aria-live="polite" class="muted"></div>
        </div>

        <p class="note mt-3">
          Default POST endpoint is <code>/login</code>. To override, add <code>data-hype-post="/your/login"</code> on the <code>&lt;form&gt;</code>.
        </p>
      </form>

      <div class="mt-3">
        <strong>Why this is declarative:</strong>
        <ul class="list-disc ml-5 mt-2">
          <li>No inline scripts on elements — just attributes and standard form fields.</li>
          <li>Server integration is simple: return JSON such as <code>{ "ok": true, "user": {...} }</code>.</li>
          <li>All requests use <code>credentials: 'same-origin'</code> so cookie-based sessions work.</li>
        </ul>
      </div>
    </section>

    <section class="card" aria-labelledby="hype-declarative">
      <h2 id="hype-declarative" class="text-lg font-medium mb-2">2) Hype-style declarative chain (data-hype attributes)</h2>
      <p class="muted mb-4">
        If the Hype runtime is available, you can declare behavior using <code>data-hype-*</code> attributes. The runtime executes sequences like <code>["seq", ["toggle","loading"], ["pub","$fetch",null]]</code>.
      </p>

      <!-- data-hype-state: local optimistic state -->
      <form id="hype-login" class="card" data-hype-state='{"loading": false}' data-hype-post="/login" data-hype-on-submit='["seq", ["toggle", "loading"], ["pub", "$fetch", null]]'>
        <h3 class="mb-2">Hype declarative flow</h3>

        <div class="field">
          <label for="uh">Username</label>
          <input id="uh" name="username" type="text" />
        </div>
        <div class="field">
          <label for="ph">Password</label>
          <input id="ph" name="password" type="password" />
        </div>

        <div class="flex items-center gap-3">
          <button type="submit" class="btn">Sign in</button>
          <span data-hype-show="!loading" class="muted">Ready</span>
          <span data-hype-show="loading" class="muted">Signing in…</span>
        </div>

        <div data-login-message aria-live="polite" class="muted mt-2"></div>

        <p class="note mt-3">
          The demo runtime will POST and merge server response fields back into state.
        </p>
      </form>
    </section>

    <section class="card" aria-labelledby="server-tips">
      <h2 id="server-tips" class="text-lg font-medium mb-2">3) Server expectations & UX tips</h2>
      <ul class="list-disc ml-5">
        <li></li>Return JSON from your login endpoint. Example:
          <pre class="mt-2 p-2 bg-gray-100 rounded text-sm">{ "ok": true, "user": { "id": 1, "name": "Alice" } }</pre>
        </li>
        <li class="mt-2">On failure return <code>{ "ok": false, "error": "Invalid credentials" }</code>.</li>
        <li class="mt-2">Ensure requests are handled with <code>credentials: 'same-origin'</code> to use cookie sessions.</li>
      </ul>

      <p class="note mt-3">
        To customize credential mapping (passkeys/webauthn), create a client via <code>createClient({ form: { credentialMapper } })</code> and wire it into an optional auth binder module.
      </p>
    </section>

    <footer class="muted text-sm mt-4">
      Notes:
      <ul class="list-disc ml-5 mt-2">
        <li>Hype will not auto-initialize. Initialize explicitly from your templates.</li>
        <li>Use <code>data-hype-*</code> attributes for declarative behavior.</li>
      </ul>
    </footer>
  </div>

  <!-- Explicit markup-first initializer: authors must import and call hype.init() -->
  <script type="module">
    import { hype } from '/static/js/hype.js';
    // Explicit initialization (idempotent)
    hype.init();
  </script>
</body>
</html>
