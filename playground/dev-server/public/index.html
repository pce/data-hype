<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Hype Playground — Dev</title>
  <meta name="description" content="Hype playground examples (development). Examples assume the dev backend is running and prefer DSL JSON for CSP-friendly evaluation." />
  <!--
    Dev-friendly Content Security Policy (adjust for production):
    - Keeps runtime import and websocket connections to same-origin.
    - In production remove 'unsafe-inline' and restrict connect/script/style sources.
  -->
  <meta http-equiv="Content-Security-Policy"
        content="default-src 'self' data:; script-src 'self' https:; connect-src 'self' ws: wss: http: https:; style-src 'self' 'unsafe-inline' https:; img-src 'self' data: https:;" />
  <style>
    :root {
      --bg: #f8fafc;
      --card: #ffffff;
      --text: #0f172a;
      --muted: #64748b;
      --accent: #0366d6;
      --radius: 10px;
      --gap: 12px;
    }
    html, body {
      height: 100%;
      margin: 0;
      background: var(--bg);
      color: var(--text);
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    }
    .wrap { max-width: 1100px; margin: 28px auto; padding: 18px; }
    .card { background: var(--card); border-radius: var(--radius); padding: 18px; box-shadow: 0 1px 2px rgba(2,6,23,0.06); margin-bottom: 16px; }
    header .title { display:flex; gap:var(--gap); align-items:center; justify-content:space-between; flex-wrap:wrap; }
    h1 { margin: 0; font-size: 1.25rem; }
    p.lead { margin: 6px 0 0; color: var(--muted); }
    .grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:12px; margin-top:12px; }
    .link-card { display:flex; flex-direction:column; justify-content:space-between; padding:14px; border-radius:8px; background:linear-gradient(180deg,rgba(3,102,214,0.03),transparent); border:1px solid rgba(3,102,214,0.06); color:inherit; text-decoration:none; min-height:84px; }
    .link-card h3 { margin: 0; font-size: 1rem; }
    .link-card p { margin: 6px 0 0; color: var(--muted); font-size: 0.92rem; }
    .meta { font-size: 0.85rem; color: var(--muted); margin-top: 8px; }
    code.inline { background: rgba(2,6,23,0.03); padding: 2px 6px; border-radius:4px; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, monospace; font-size: .9em; }
    pre.cmd { background: #0b1220; color: #e6eef6; padding: 10px; border-radius:6px; overflow:auto; font-size:13px; margin-top:8px; }
    footer { color:#94a3b8; text-align:center; margin-top:16px; font-size:13px; }
    @media (max-width:520px) { .wrap { padding: 12px; } }
  </style>
</head>
<body>
  <div class="wrap">
    <header class="card" role="banner" aria-label="Hype Playground header">
      <div class="title">
        <div>
          <h1>Hype — Playground (dev)</h1>
          <p class="lead">Interactive examples that assume the dev backend is running (WebSocket / SSE / API). Examples prefer DSL JSON attributes for CSP compatibility.</p>
        </div>

        <div style="text-align:right">
          <a class="link-card" href="/reactive_counter.html" style="display:inline-block;min-width:160px;padding:8px 12px">Quick: Reactive counter</a>
        </div>
      </div>
    </header>

    <section class="card" aria-labelledby="examples">
      <h2 id="examples" style="margin:0 0 8px 0">Examples</h2>
      <p class="meta">Open any example — pages progressively enhance when the Hype runtime is available at <code class="inline">/static/js/hype.js</code>.</p>

      <div class="grid" role="list" aria-label="Examples list">
        <a class="link-card" role="listitem" href="/live.html">
          <div>
            <h3>Live — Stocks (WebSocket)</h3>
            <p>WebSocket-driven live ticker. Client attempts <code class="inline">/_hype_live</code> first and falls back when necessary.</p>
          </div>
          <div class="meta">WebSocket live demo</div>
        </a>

        <a class="link-card" role="listitem" href="/sse.html">
          <div>
            <h3>SSE — Stocks</h3>
            <p>Server-Sent Events demo connecting to <code class="inline">/stocks/sse</code>. Use simulate fallback if backend not present.</p>
          </div>
          <div class="meta">SSE demo</div>
        </a>

        <a class="link-card" role="listitem" href="/reactive.html">
          <div>
            <h3>Reactive — Examples</h3>
            <p>Showcases state, conditional show, classes, binds and forms using DSL JSON expressions.</p>
          </div>
          <div class="meta">state & bind</div>
        </a>

        <a class="link-card" role="listitem" href="/pubsub.html">
          <div>
            <h3>Pub/Sub demo</h3>
            <p>Demonstrates the Hype pubsub plugin and a DOM CustomEvent bridge so the page works without the runtime.</p>
          </div>
          <div class="meta">pub/sub</div>
        </a>

        <a class="link-card" role="listitem" href="/django.html">
          <div>
            <h3>Django integration</h3>
            <p>Example markup for progressive enhancement in server frameworks (optimistic UI & built-in CSRF handling).</p>
          </div>
          <div class="meta">server templates</div>
        </a>

        <a class="link-card" role="listitem" href="/reactive_counter.html">
          <div>
            <h3>Reactive Counter</h3>
            <p>Minimal example showing DSL JSON handlers and data binding. Useful as a starting point.</p>
          </div>
          <div class="meta">minimal init</div>
        </a>
      </div>
    </section>

    <section class="card" aria-labelledby="endpoints">
      <h2 id="endpoints" style="margin:0 0 8px 0">Dev server endpoints</h2>
      <ul class="meta" style="margin:8px 0 0 18px; padding-left:18px;">
        <li><code class="inline">GET /</code> — this index page</li>
        <li><code class="inline">GET /api/items</code> — JSON snapshot of demo items</li>
        <li><code class="inline">GET /_hype_snapshot/:id</code> — HTML fragment for a region</li>
        <li><code class="inline">GET /_hype_join_token/:id</code> — short-lived join token for WebSocket joins (dev)</li>
        <li><code class="inline">POST /items/:id/toggle</code> — toggle an item's state (form or XHR)</li>
        <li><code class="inline">WS /_hype_live</code> — preferred WebSocket endpoint for live protocol</li>
        <li><code class="inline">GET /stocks/sse</code> — SSE endpoint used by the SSE examples</li>
      </ul>

      <div style="margin-top:12px;">
        <strong>Run dev server</strong>
        <pre class="cmd">cd hype/playground/dev-server
pnpm install
pnpm run dev</pre>

        <p class="meta" style="margin-top:8px;">When the dev server runs, the public folder is served and the live endpoints listed above are available. Examples assume the backend is running; each example will fall back to simulation if the server is unreachable.</p>
      </div>
    </section>

    <section class="card" aria-labelledby="dsl">
      <h2 id="dsl" style="margin:0 0 8px 0">DSL JSON — CSP-friendly examples</h2>
      <p class="meta">Prefer DSL JSON attributes. The runtime parses JSON and evaluates via a safe interpreter (no eval/new Function), making this suitable for restrictive CSPs.</p>

      <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:12px">
        <div class="card" style="padding:12px">
          <h3 style="margin:0 0 8px 0">Toggle</h3>
          <p class="meta" style="margin:0 0 8px 0">Toggle state declaratively:</p>
          <pre class="cmd"><code>&lt;div data-hype-state='{"open":false}'&gt;
  &lt;button data-hype-on-click='["toggle","open"]'&gt;Toggle&lt;/button&gt;
  &lt;div data-hype-show="open"&gt;Shown when open&lt;/div&gt;
&lt;/div&gt;</code></pre>
        </div>

        <div class="card" style="padding:12px">
          <h3 style="margin:0 0 8px 0">Optimistic server sync</h3>
          <p class="meta" style="margin:0 0 8px 0">Optimistic toggle plus server fetch (assumes backend endpoint exists):</p>
          <pre class="cmd"><code>&lt;button
  data-hype-state='{"favorited":false,"syncing":false}'
  data-hype-post="/api/jobs/123/toggle-favorite"
  data-hype-swap="none"
  data-hype-on-click='["seq",["toggle","favorited"],["set","syncing",true],["pub","$fetch",null]]'
&gt;Favorite&lt;/button&gt;</code></pre>
        </div>
      </div>
    </section>

    <footer class="card" role="contentinfo">
      Hype playground — dev • <span class="meta">examples assume backend endpoints exist; tighten CSP and origins for production</span>
    </footer>
  </div>

  <script type="module">
    // Progressive, non-blocking import of the optional Hype runtime.
    // This keeps pages functional without the runtime and avoids eval/new Function usage.
    (async function () {
      try {
        const path = '/static/js/hype.js';
        const mod = await import(path).catch(() => null);
        const hype = mod && (mod.hype || mod.default || mod) || null;
        if (hype && typeof hype.init === 'function') {
          try { hype.init(); } catch (e) { console.warn('hype.init() error', e); }
          window.hypeModuleInitialized = true;
          console.debug('Hype runtime initialized.');
        } else if (mod) {
          window.hypeModule = mod;
        }
      } catch (err) {
        // Non-fatal in dev; examples include simulation fallback when appropriate.
        console.debug('Hype dynamic import failed:', err);
      }
    })();
  </script>
</body>
</html>