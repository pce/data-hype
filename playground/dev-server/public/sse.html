<!doctype html>
<html lang="en">
<head></head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Live Stocks — SSE Example</</title>title>
  <meta name="description" content="Stocks ticker demo using Server-Sent Events (SSE). Progressive enhancement with an initial JSON snapshot and an external ES module client." />

  <!-- Tailwind utilities (project provides /tailwind.css) -->
  <link rel="stylesheet" href="/tailwind.css" />

  <!-- Shared demo CSS (external, CSP-friendly) -->
  <link rel="stylesheet" href="/static/css/crud-demo.css" />
</head>
<body class="bg-gradient-to-b from-teal-800 to-gray-600 min-h-screen text-slate-100 antialiased">
  <div class="max-w-4xl mx-auto p-8">
    <!-- Optional server-side include placeholder:
         Replace with your layout include if you have templating support.
         Example: <!--#include virtual="/layout/header.html" --> -->
    <header class="mb-8">
      <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-6">
        <div class="min-w-0">
          <h1 class="text-4xl md:text-5xl leading-tight font-thin text-white tracking-tight">
            Live Stocks — SSE Example
            <span class="block mt-3 text-sm md:text-base font-light text-transparent bg-clip-text bg-gradient-to-r from-orange-400 via-rose-400 to-amber-400">
              Server-Sent Events (progressive, markup-first)
            </span>
          </h1>

          <p class="mt-4 text-sm text-slate-200/80">
            Connects to a Server-Sent Events endpoint at <code class="font-mono bg-white/5 px-1 rounded">/stocks/sse</code>.
            Use "Simulate" to generate local updates when the backend SSE endpoint is not available.
          </p>
        </div>

        <div class="flex items-center gap-3">
          <nav aria-label="page navigation" class="hidden sm:flex gap-3">
            <a class="text-slate-200/80 hover:text-white text-sm" href="/">← Back to examples</a>
            <a class="text-slate-200/80 hover:text-white text-sm" href="/live.html">WebSocket example</a>
          </nav>

          <div class="flex flex-col items-end gap-3">
            <div class="flex items-center gap-3">
              <span id="conn-dot" class="w-3 h-3 rounded-full bg-red-500" aria-hidden="true"></span>
              <span id="conn-text" class="text-sm font-mono text-slate-200/90">disconnected</span>
            </div>

            <div class="flex items-center gap-2">
              <button id="connectBtn" class="px-3 py-1 rounded-md bg-white/10 hover:bg-white/20 text-white text-sm">Connect</button>
              <button id="disconnectBtn" class="hidden px-3 py-1 rounded-md bg-white/5 text-white text-sm">Disconnect</button>
            </div>
          </div>
        </div>
      </div>

      <nav class="mt-6 flex gap-3 text-sm text-slate-200/70">
        <a class="font-mono" href="/">Examples</a>
        <a class="font-mono" href="/live.html">WebSocket</a>
        <a class="font-mono" href="/sse.html">SSE</a>
      </nav>
    </header>

    <section aria-labelledby="sse-info" class="mb-6">
      <div class="bg-white/5 rounded-xl p-6">
        <h2 id="sse-info" class="text-lg font-medium text-white">Ticker (SSE)</h2>
        <p class="text-sm text-slate-200/80 mt-2">
          Expected messages (JSON): <code class="font-mono bg-white/5 px-1 rounded">{ "type": "stocks:snapshot", "items": [...] }</code>
          or <code class="font-mono bg-white/5 px-1 rounded">{ "type": "stock:update", "symbol": "AAPL", "price": 123.45 }</code>.
        </p>

        <div class="mt-4 overflow-auto bg-transparent rounded">
          <table class="min-w-full text-left" role="table" aria-live="polite" aria-describedby="sse-info">
            <thead class="border-b border-white/10">
              <tr></tr>
                <th class="pb-3 pr-6 text-sm font-medium text-slate-200">Symbol</th>
                <th class="pb-3 pr-6 text-sm font-medium text-slate-200">Price</th>
                <th class="pb-3 pr-6 text-sm font-medium text-slate-200">Change</th>
                <th class="pb-3 text-sm font-medium text-slate-200">Last</th>
              </tr>
            </thead>

            <tbody id="rows" class="divide-y divide-white/5">
              <!-- Progressive fallback rows so the page is useful without JS -->
              <tr id="row-AAPL" class="bg-white/3">
                <td class="py-3"><strong class="font-mono text-white">AAPL</strong></td>
                <td class="py-3 font-mono text-slate-200 price">—</td>
                <td class="py-3 font-mono text-slate-200 change">—</td>
                <td class="py-3 text-slate-400 font-mono">—</td>
              </tr>
              <tr id="row-GOOG">
                <td class="py-3"><strong class="font-mono text-white">GOOG</strong></td>
                <td class="py-3 font-mono text-slate-200 price">—</td>
                <td class="py-3 font-mono text-slate-200 change">—</td>
                <td class="py-3 text-slate-400 font-mono">—</td>
              </tr>
              <tr id="row-MSFT">
                <td class="py-3"><strong class="font-mono text-white">MSFT</strong></td>
                <td class="py-3 font-mono text-slate-200 price">—</td>
                <td class="py-3 font-mono text-slate-200 change">—</td>
                <td class="py-3 text-slate-400 font-mono">—</td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="mt-4 text-sm text-slate-200/80">
          If the backend does not expose <code class="font-mono bg-white/5 px-1 rounded">/stocks/sse</code>, enable "Simulate" to generate local updates.
        </div>

        <div class="mt-4 flex flex-col sm:flex-row sm:items-center gap-3">
          <label for="simulate" class="flex items-center gap-2 text-sm text-slate-200">
            <input id="simulate" type="checkbox" class="rounded text-teal-400" /> Simulate updates locally
          </label>

          <div class="sm:ml-auto flex items-center gap-2">
            <label for="symbol" class="sr-only">Subscribe symbol</label>
            <input id="symbol" placeholder="e.g. AAPL" aria-label="Subscribe symbol" class="px-3 py-2 rounded-md bg-white/5 text-white font-mono text-sm" />
            <button id="addSymbol" class="px-3 py-2 rounded-md border border-white/10 text-white text-sm">Add</button>
          </div>
        </div>
      </div>
    </section>

    <section class="bg-white/5 rounded-xl p-6 mb-6">
      <h3 class="text-sm font-medium text-white mb-3">Developer notes</h3>
      <ul class="text-slate-200/80 list-disc list-inside space-y-1">
        <li>The dev backend can provide <code class="font-mono bg-white/5 px-1 rounded">/stocks/sse</code>. Each SSE event should contain a single JSON payload on the data: line.</li>
        <li>This page includes an embedded JSON snapshot and static rows so it remains useful without JS or when the SSE endpoint is unavailable.</li>
        <li>The client is an external ES module (no inline scripts) to reduce CSP friction and work with modern browsers.</li>
      </ul>
    </section>

    <footer class="text-sm text-slate-300 text-center py-4">
      <div class="flex flex-col sm:flex-row sm:justify-between gap-2">
        <div>SSE — Live stocks demo</div>
        <div><a class="text-slate-200 underline" href="/">← Back to examples</a></div>
      </div>
    </footer>
  </div>

  <!-- initial snapshot (progressive enhancement). This is application/json and not executed -->
  <script id="stocks-initial" type="application/json">
{
  "items": [
    { "symbol": "AAPL", "price": 150.23, "change": 0.42, "timestamp": 1690000000000 },
    { "symbol": "GOOG", "price": 2739.12, "change": -3.58, "timestamp": 1690000000000 },
    { "symbol": "MSFT", "price": 322.45, "change": 1.05, "timestamp": 1690000000000 }
  ]
}
  </script>

  <!-- External module: progressive-enhancement client (modern browsers). Keep external to satisfy CSP -->
  <script type="module" src="/static/js/stocks-sse.js"></script>
</body>
</html>